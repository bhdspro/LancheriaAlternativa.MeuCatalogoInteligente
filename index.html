<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo Inteligente - Lancheria Alternativa</title>
    <!-- Favicon Premium Adicionado -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%231F2937%22></rect><path d=%22M30 35h40M30 50h40M30 65h25%22 stroke=%22%23F97316%22 stroke-width=%228%22 stroke-linecap=%22round%22/></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            primary: '#F97316',
                            secondary: '#FB923C',
                            background: '#111827',
                            surface: '#1F2937',
                            text: '#F9FAFB',
                            subtle: '#9CA3AF',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'fade-out': 'fadeOut 0.5s ease-in forwards',
                        'slide-in-up': 'slideInUp 0.5s ease-out forwards',
                        'slide-out-down': 'slideOutDown 0.5s ease-in forwards',
                        'slide-in-right': 'slideInRight 0.3s ease-out forwards',
                        'slide-out-right': 'slideOutRight 0.3s ease-in forwards',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
                        fadeOut: { '0%': { opacity: 1 }, '100%': { opacity: 0 } },
                        slideInUp: { '0%': { transform: 'translateY(100%)', opacity: 0 }, '100%': { transform: 'translateY(0)', opacity: 1 } },
                        slideOutDown: { '0%': { transform: 'translateY(0)', opacity: 1 }, '100%': { transform: 'translateY(100%)', opacity: 0 } },
                        slideInRight: { '0%': { transform: 'translateX(100%)' }, '100%': { transform: 'translateX(0)' } },
                        slideOutRight: { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(100%)' } },
                    }
                }
            }
        }
    </script>
    <style>
        /* Estilos para a barra de rolagem */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1F2937; }
        ::-webkit-scrollbar-thumb { background: #4B5563; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #6B7280; }
        
        /* Estilo para mensagem de erro customizada */
        .form-error-message {
            display: none;
            background-color: #7f1d1d;
            color: #fecaca;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            text-align: center;
            font-weight: 500;
        }
    </style>
</head>
<body class="bg-brand-background text-brand-text font-sans antialiased">

    <!-- Container Principal -->
    <div id="main-container" class="max-w-4xl mx-auto p-4 sm:p-6">

        <!-- Cabeçalho -->
        <header class="text-center mb-8 sticky top-0 bg-brand-background/80 backdrop-blur-sm py-4 z-10">
            <h1 class="text-3xl sm:text-5xl font-bold text-brand-primary">Lancheria Alternativa</h1>
            <p class="text-brand-subtle mt-2 text-sm sm:text-base">O sabor que você já conhece, agora na palma da sua mão!</p>
            <!-- Botões otimizados para mobile -->
            <div class="flex flex-wrap justify-center items-center gap-2 mt-6">
                <a href="https://instagram.com/lancheriaalternativa26" target="_blank" class="flex items-center space-x-2 bg-brand-surface hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-full transition-transform transform hover:scale-105 text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.149-4.771-1.664-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011-3.584.069-4.85c.149-3.225 1.664-4.771 4.919-4.919 1.266.058 1.644.07 4.85.07zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.667.072 4.947c.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072s3.667-.014 4.947-.072c4.358-.2 6.78-2.618 6.98-6.98.059-1.281.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.2-4.358-2.618-6.78-6.98-6.98-1.281-.059-1.689-.073-4.948-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44 1.441-.645 1.441-1.44-.645-1.44-1.441-1.44z"/></svg>
                    <span>Instagram</span>
                </a>
                <a href="https://www.google.com/maps/dir//Rua%20Geraldo%20Castellano,%2026%20-%20Jardim%20S%C3%A3o%20Paulo%20II,%20Londrina%20-%20PR" target="_blank" class="flex items-center space-x-2 bg-brand-surface hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-full transition-transform transform hover:scale-105 text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-4.198 0-8 3.403-8 7.602 0 4.198 3.469 9.21 8 16.398 4.531-7.188 8-12.2 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"/></svg>
                    <span>Retirada</span>
                </a>
                <a href="https://search.google.com/local/writereview?placeid=ChIJ6yEHpydF65QR8WMHlDEOrDs" target="_blank" class="flex items-center space-x-2 bg-brand-surface hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-full transition-transform transform hover:scale-105 text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>
                    <span>Avalie</span>
                </a>
            </div>
        </header>

        <!-- Corpo do Catálogo -->
        <main id="menu-container" class="space-y-10">
            <!-- As categorias e itens do catálogo serão inseridos aqui pelo JavaScript -->
        </main>

        <!-- Rodapé -->
        <footer class="text-center mt-12 border-t border-gray-700 pt-6">
            <div id="footer-ad" class="bg-brand-surface p-4 rounded-lg mb-6">
                <h3 class="font-bold text-brand-secondary">Quer um Catálogo Inteligente como este para o seu negócio?</h3>
                <p class="text-sm text-brand-subtle mt-1">Aumente seus pedidos e impressione seus clientes. Clique no botão e saiba mais!</p>
                <button id="cta-footer-button" class="mt-3 bg-brand-primary hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">Quero um Catálogo Inteligente</button>
            </div>
            <p class="text-brand-subtle text-xs sm:text-sm">&copy; 2025 Meu Catálogo Inteligente. Todos os direitos reservados.</p>
        </footer>
    </div>

    <!-- Botão Flutuante do Carrinho -->
    <button id="cart-button" class="fixed bottom-6 right-6 bg-brand-primary hover:bg-orange-600 text-white p-4 rounded-full shadow-lg transition-transform transform hover:scale-110 z-30">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
        <span id="cart-count" class="absolute -top-1 -right-1 bg-red-600 text-white text-xs font-bold rounded-full h-6 w-6 flex items-center justify-center">0</span>
    </button>
    
    <!-- Painel do Carrinho -->
    <div id="cart-panel-overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 animate-fade-in"></div>
    <div id="cart-panel" class="hidden fixed top-0 right-0 h-full w-full max-w-md bg-brand-background shadow-2xl z-50 flex flex-col">
        <div class="flex justify-between items-center p-4 border-b border-gray-700">
            <h2 class="text-2xl font-bold text-white">Seu Pedido</h2>
            <button id="close-cart-button" class="text-gray-400 hover:text-white">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
        <div id="cart-items-container" class="flex-grow p-4 overflow-y-auto">
            <!-- Itens do carrinho serão inseridos aqui -->
        </div>
        <div class="p-4 border-t border-gray-700">
            <div class="flex justify-between items-center text-lg font-bold">
                <span>Total:</span>
                <span id="cart-total">R$ 0,00</span>
            </div>
            <button id="checkout-button" class="mt-4 w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-4 rounded-lg text-lg">
                Enviar Pedido via WhatsApp
            </button>
        </div>
    </div>

    <!-- Popup de Oferta Inicial -->
    <div id="offer-popup" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-brand-surface rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full text-center relative">
            <button id="close-offer-popup" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <h2 class="text-2xl font-bold text-brand-primary mb-3">Transforme Seu Catálogo, Aumente Suas Vendas!</h2>
            <p class="text-brand-subtle mb-5">Cansado de catálogos ultrapassados? Tenha um Catálogo Inteligente, interativo e que vende por você, 24h por dia.</p>
            <div class="bg-gray-800 p-4 rounded-lg mb-5 text-left">
                <p class="font-semibold text-white">🔥 Oferta Exclusiva por Tempo Limitado:</p>
                <ul class="list-disc list-inside text-brand-subtle mt-2 space-y-1 text-sm">
                    <li><span class="font-bold text-green-400">7 DIAS GRÁTIS</span> para testar sem compromisso.</li>
                    <li>Após o teste, o catálogo é seu para <span class="font-bold text-white">SEMPRE</span>.</li>
                    <li>Taxa única de criação: <span class="line-through">R$29,90</span> por apenas <span class="font-bold text-green-400">R$9,90</span>.</li>
                    <li>Atualizações futuras? Apenas R$4,90 (e somente se você precisar!).</li>
                </ul>
                <p class="text-xs text-center mt-3 text-gray-400">Sem mensalidades. Sem pegadinhas.</p>
            </div>
            <button id="cta-popup-button" class="w-full bg-brand-primary hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-transform transform hover:scale-105">QUERO MEU TESTE GRÁTIS!</button>
        </div>
    </div>

    <!-- Popup de Envio de Catálogo -->
    <div id="submission-popup" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-brand-surface rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full relative">
            <button id="close-submission-popup" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            <div id="submission-form-container">
                <h2 class="text-2xl font-bold text-brand-primary mb-3 text-center">Estamos quase lá!</h2>
                <p class="text-brand-subtle mb-6 text-center">Envie seu catálogo atual e seu WhatsApp. Entregaremos sua nova versão inteligente em até 24 horas!</p>
                <form id="submission-form" class="space-y-4">
                    <input type="text" id="whatsapp-input" placeholder="Seu WhatsApp com DDD" required class="w-full bg-gray-800 border border-gray-600 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-brand-primary">
                    <input type="text" id="link-input" placeholder="Ou cole o link do catálogo aqui" class="w-full bg-gray-800 border border-gray-600 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-brand-primary">
                    <label for="file-upload" class="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center cursor-pointer">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        <span>Anexar arquivo do catálogo</span>
                    </label>
                    <input id="file-upload" type="file" class="hidden">
                    <p id="file-name" class="text-sm text-center text-brand-subtle"></p>
                    <button type="submit" class="w-full bg-brand-primary hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition-transform transform hover:scale-105">Enviar e Começar Teste Grátis</button>
                </form>
                <div id="form-error" class="form-error-message"></div>
            </div>
            <div id="submission-success" class="hidden text-center">
                 <h2 class="text-2xl font-bold text-green-400 mb-3">Enviado com Sucesso!</h2>
                 <p class="text-brand-subtle">Recebemos suas informações. Em breve, nossa equipe entrará em contato pelo WhatsApp para entregar seu novo Catálogo Inteligente. Fique de olho!</p>
            </div>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DADOS DO CATÁLOGO (ATUALIZADO) ---
    const restaurantWhatsapp = "5543988222204"; 
    const menuData = [
        {
            category: "Lanches",
            items: [
                { name: "X-Hambúrguer", description: "Pão, hambúrguer, presunto, queijo, maionese, mostarda e ketchup.", price: 17.00 },
                { name: "X-Salada", description: "Pão, hambúrguer, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 19.00 },
                { name: "X-Bacon", description: "Pão, hambúrguer, bacon, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 24.00 },
                { name: "X-Frango", description: "Pão, frango, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 21.00 },
                { name: "X-Salada c/ Salsicha", description: "Pão, hambúrguer, 2 salsichas, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 22.00 },
                { name: "X-Calabresa", description: "Pão, calabresa, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 22.00 },
                { name: "X-Coração", description: "Pão, coração, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 24.00 },
                { name: "X-Coração (versão 2)", description: "Pão, hambúrguer, coração, bacon, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 28.00 },
                { name: "X-Coração c/ Bacon", description: "Pão, coração, bacon, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 25.00 },
                { name: "X-Frango Catupiry", description: "Pão, frango, catupiry, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 22.00 },
                { name: "X-Frango c/ Calabresa", description: "Pão, frango, calabresa, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 24.00 },
                { name: "X-Frango c/ Bacon", description: "Pão, frango, bacon, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 25.00 },
                { name: "X-Egg", description: "Pão, hambúrguer, ovo, 2 salsichas, presunto, queijo, batata palha, alface, tomate, maionese, mostarda e ketchup.", price: 24.00 },
                { name: "X-Tudo", description: "Pão, hambúrguer, frango, calabresa, bacon, queijo, batata palha, milho, alface, tomate, maionese, mostarda e ketchup.", price: 28.00 },
                { name: "Dog Simples", description: "2 Salsichas, queijo, batata palha, milho, tomate, maionese, mostarda e ketchup.", price: 17.00 },
                { name: "Dog Simples (versão 2)", description: "2 Salsichas, batata palha, milho, tomate, maionese, mostarda e ketchup.", price: 15.00 },
                { name: "Dog Frango", description: "2 Salsichas, frango, batata palha, milho, tomate, maionese, mostarda e ketchup.", price: 21.00 },
                { name: "Dog Bacon", description: "2 Salsichas, bacon, batata palha, milho, tomate, maionese, mostarda e ketchup.", price: 22.00 },
                { name: "Torrada", description: "Pão de hambúrguer, presunto, queijo, maionese, mostarda e ketchup.", price: 12.00 },
                { name: "Torrada Americana", description: "Pão de hambúrguer, presunto, queijo, alface, tomate, maionese, mostarda e ketchup.", price: 16.00 },
            ]
        },
        {
            category: "Porções",
            items: [
                { name: "Picado 1 (Pequena)", description: "Batata frita, calabresa, frango, ovo de codorna e queijo.", price: 65.00 },
                { name: "Picado 1 (Média)", description: "Batata frita, calabresa, frango, ovo de codorna e queijo.", price: 75.00 },
                { name: "Picado 1 (Grande)", description: "Batata frita, calabresa, frango, ovo de codorna e queijo.", price: 85.00 },
                { name: "Picado 2 (Pequena)", description: "Batata frita, calabresa, coração, bacon, ovo de codorna e queijo.", price: 65.00 },
                { name: "Picado 2 (Média)", description: "Batata frita, calabresa, coração, bacon, ovo de codorna e queijo.", price: 75.00 },
                { name: "Picado 2 (Grande)", description: "Batata frita, calabresa, coração, bacon, ovo de codorna e queijo.", price: 85.00 },
                { name: "Fritas com Queijo (Pequena)", description: "", price: 25.00 },
                { name: "Fritas com Queijo (Média)", description: "", price: 30.00 },
                { name: "Fritas com Queijo (Grande)", description: "", price: 35.00 },
            ]
        },
        {
            category: "Pastéis",
            items: [
                { name: "Carne / Frango / Presunto e Queijo", price: 10.00 },
                { name: "Frango Catupiry", price: 11.00 },
                { name: "Carne com Queijo / Frango com Queijo", price: 11.00 },
                { name: "Carne, Frango, Presunto e Queijo", price: 15.00 },
                { name: "Adicionais (Ovo)", price: 2.00 },
            ]
        },
        {
            category: "Bebidas",
            items: [
                { name: "Refrigerante 1L", price: 4.50 },
                { name: "Refrigerante 2L", price: 8.00 },
                { name: "Refrigerante Lata", price: 3.50 },
                { name: "Suco de Laranja 1L", price: 13.00 },
                { name: "Cerveja Lata", price: 4.50 },
                { name: "Cerveja Litrinho", price: 3.50 },
                { name: "Água com Gás", price: 3.00 },
                { name: "Água sem Gás", price: 3.00 },
            ]
        }
    ];

    const adItem = {
        isAd: true,
        title: "🚀 Turbine seu negócio com um Catálogo Inteligente!",
        description: "Aumente seus pedidos, fidelize clientes e automatize seu atendimento. Clique para saber mais.",
    };
    
    // --- ELEMENTOS DO DOM ---
    const menuContainer = document.getElementById('menu-container');
    const offerPopup = document.getElementById('offer-popup');
    const closeOfferPopupBtn = document.getElementById('close-offer-popup');
    const ctaFooterBtn = document.getElementById('cta-footer-button');
    const ctaPopupBtn = document.getElementById('cta-popup-button');
    const cartButton = document.getElementById('cart-button');
    const cartCount = document.getElementById('cart-count');
    const cartPanel = document.getElementById('cart-panel');
    const cartPanelOverlay = document.getElementById('cart-panel-overlay');
    const closeCartButton = document.getElementById('close-cart-button');
    const cartItemsContainer = document.getElementById('cart-items-container');
    const cartTotal = document.getElementById('cart-total');
    const checkoutButton = document.getElementById('checkout-button');
    const submissionPopup = document.getElementById('submission-popup');
    const closeSubmissionPopupBtn = submissionPopup.querySelector('#close-submission-popup');
    const submissionForm = document.getElementById('submission-form');
    const submissionFormContainer = document.getElementById('submission-form-container');
    const submissionSuccess = document.getElementById('submission-success');
    const fileUpload = document.getElementById('file-upload');
    const fileNameDisplay = document.getElementById('file-name');
    const formError = document.getElementById('form-error');

    // --- LÓGICA DO CARRINHO ---
    let cart = JSON.parse(localStorage.getItem('lancheriaCart')) || [];

    function findItemDetails(itemName) {
        for (const category of menuData) {
            const foundItem = category.items.find(item => item.name === itemName);
            if (foundItem) return {...foundItem, category: category.category};
        }
        return null;
    }

    function addToCart(itemName) {
        const itemInCart = cart.find(item => item.name === itemName);
        if (itemInCart) {
            itemInCart.quantity++;
        } else {
            const itemDetails = findItemDetails(itemName);
            if (itemDetails) {
                cart.push({ ...itemDetails, quantity: 1 });
            }
        }
        updateCart();
    }
    
    function updateQuantity(itemName, newQuantity) {
        const itemInCart = cart.find(item => item.name === itemName);
        if (itemInCart) {
            if (newQuantity > 0) {
                itemInCart.quantity = newQuantity;
            } else {
                cart = cart.filter(item => item.name !== itemName);
            }
        }
        updateCart();
    }

    function updateCart() {
        localStorage.setItem('lancheriaCart', JSON.stringify(cart));
        renderCartItems();
        updateCartCount();
        updateCartTotal();
    }
    
    function updateCartCount() {
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        cartCount.textContent = totalItems;
        cartCount.classList.toggle('hidden', totalItems === 0);
    }
    
    function updateCartTotal() {
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        cartTotal.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
    }

    function renderCartItems() {
        cartItemsContainer.innerHTML = '';
        if (cart.length === 0) {
            cartItemsContainer.innerHTML = `<p class="text-brand-subtle text-center">Seu carrinho está vazio.</p>`;
            return;
        }

        cart.forEach(item => {
            const itemElement = document.createElement('div');
            itemElement.className = 'flex items-center justify-between py-2';
            itemElement.innerHTML = `
                <div class="flex-grow pr-2">
                    <p class="font-semibold">${item.name}</p>
                    <p class="text-sm text-brand-subtle">R$ ${item.price.toFixed(2).replace('.', ',')}</p>
                </div>
                <div class="flex items-center gap-2">
                    <button data-name="${item.name}" class="quantity-change bg-gray-700 rounded-md p-1 w-6 h-6 flex items-center justify-center">-</button>
                    <span>${item.quantity}</span>
                    <button data-name="${item.name}" class="quantity-change bg-gray-700 rounded-md p-1 w-6 h-6 flex items-center justify-center">+</button>
                </div>
            `;
            cartItemsContainer.appendChild(itemElement);
        });
        
        document.querySelectorAll('.quantity-change').forEach(button => {
            button.addEventListener('click', (e) => {
                const itemName = e.currentTarget.dataset.name;
                const itemInCart = cart.find(item => item.name === itemName);
                if (itemInCart) {
                    const newQuantity = e.currentTarget.textContent === '+' ? itemInCart.quantity + 1 : itemInCart.quantity - 1;
                    updateQuantity(itemName, newQuantity);
                }
            });
        });
    }
    
    function generateWhatsAppMessage() {
        if (cart.length === 0) return "Olá! Gostaria de ver o cardápio.";
        let message = "Olá! Gostaria de fazer o seguinte pedido:\n\n";
        cart.forEach(item => {
            // Alteração: Removido o 'x'
            message += `#  ${item.quantity} ${item.name}\n`;
        });
        // Alteração: Removida a linha do total
        return message;
    }
    
    function openCart() {
        cartPanelOverlay.classList.remove('hidden');
        cartPanel.classList.remove('hidden');
        cartPanel.classList.add('animate-slide-in-right');
        cartPanel.classList.remove('animate-slide-out-right');
    }
    
    function closeCart() {
        cartPanelOverlay.classList.add('animate-fade-out');
        cartPanel.classList.remove('animate-slide-in-right');
        cartPanel.classList.add('animate-slide-out-right');
        setTimeout(() => {
            cartPanelOverlay.classList.add('hidden');
            cartPanel.classList.add('hidden');
            cartPanelOverlay.classList.remove('animate-fade-out');
        }, 300);
    }
    
    // --- FUNÇÕES DE RENDERIZAÇÃO DO MENU ---
    function createAddButton(item) {
        const button = document.createElement('button');
        button.className = "bg-brand-primary hover:bg-orange-600 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105 whitespace-nowrap text-sm";
        button.textContent = "Adicionar";
        button.onclick = () => addToCart(item.name);
        return button;
    }

    function renderMenu() {
        const itemsWithAds = JSON.parse(JSON.stringify(menuData)); // Deep copy
        
        // Lógica para inserir anúncios aleatoriamente
        const adSpots = [];
        itemsWithAds.forEach((category, catIndex) => {
            if (category.items.length > 2) {
                for (let i = 1; i < category.items.length; i++) {
                    adSpots.push({cat: catIndex, item: i});
                }
            }
        });

        for (let i = adSpots.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [adSpots[i], adSpots[j]] = [adSpots[j], adSpots[i]];
        }

        const adsToPlace = Math.min(2, adSpots.length);
        const chosenSpots = adSpots.slice(0, adsToPlace);
        chosenSpots.sort((a, b) => b.cat - a.cat || b.item - a.item);
        chosenSpots.forEach(spot => {
            itemsWithAds[spot.cat].items.splice(spot.item, 0, adItem);
        });


        itemsWithAds.forEach(category => {
            const categorySection = document.createElement('section');
            categorySection.id = category.category.toLowerCase().replace(/ /g, '-');
            
            const categoryTitle = document.createElement('h2');
            categoryTitle.className = "text-2xl sm:text-3xl font-bold text-brand-secondary border-b-2 border-brand-primary pb-2 mb-6";
            categoryTitle.textContent = category.category;
            categorySection.appendChild(categoryTitle);

            const itemsGrid = document.createElement('div');
            itemsGrid.className = "grid grid-cols-1 md:grid-cols-2 gap-4";
            
            category.items.forEach(item => {
                const itemCard = document.createElement('div');
                if (item.isAd) {
                    itemCard.className = "bg-brand-primary/20 border-2 border-dashed border-brand-primary rounded-lg p-4 flex flex-col justify-center items-center text-center cursor-pointer";
                    itemCard.innerHTML = `
                        <h3 class="font-bold text-brand-secondary">${item.title}</h3>
                        <p class="text-sm text-brand-subtle mt-1">${item.description}</p>
                    `;
                    itemCard.onclick = () => showPopup(offerPopup);
                } else {
                    itemCard.className = "bg-brand-surface rounded-lg p-4 flex items-start justify-between space-x-4";
                    const itemInfo = `
                        <div class="flex-1">
                            <h3 class="font-semibold text-base sm:text-lg text-brand-text">${item.name}</h3>
                            ${item.description ? `<p class="text-sm text-brand-subtle mt-1">${item.description}</p>` : ''}
                            <p class="font-bold text-brand-secondary mt-2">R$ ${item.price.toFixed(2).replace('.', ',')}</p>
                        </div>
                    `;
                    itemCard.innerHTML = itemInfo;
                    itemCard.appendChild(createAddButton(item));
                }
                itemsGrid.appendChild(itemCard);
            });

            categorySection.appendChild(itemsGrid);
            menuContainer.appendChild(categorySection);
        });
    }

    // --- LÓGICA DO POPUP ---
    const showPopup = (popup) => {
        popup.classList.remove('hidden');
        popup.classList.add('animate-fade-in');
        popup.querySelector(':scope > div').classList.remove('animate-slide-out-down');
        popup.querySelector(':scope > div').classList.add('animate-slide-in-up');
    };

    const hidePopup = (popup) => {
        popup.classList.remove('animate-fade-in');
        popup.classList.add('animate-fade-out');
        popup.querySelector(':scope > div').classList.remove('animate-slide-in-up');
        popup.querySelector(':scope > div').classList.add('animate-slide-out-down');
        setTimeout(() => {
            popup.classList.add('hidden');
            popup.classList.remove('animate-fade-out'); // Reset animation class
        }, 500);
    };

    // --- EVENT LISTENERS ---
    
    // Event Listeners do Carrinho
    if(cartButton) cartButton.addEventListener('click', openCart);
    if(closeCartButton) closeCartButton.addEventListener('click', closeCart);
    if(cartPanelOverlay) cartPanelOverlay.addEventListener('click', closeCart);
    if(checkoutButton) checkoutButton.addEventListener('click', () => {
        const message = generateWhatsAppMessage();
        window.open(`https://wa.me/${restaurantWhatsapp}?text=${encodeURIComponent(message)}`, '_blank');
    });

    // Lógica dos popups de marketing
    const openSubmissionPopup = () => {
        hidePopup(offerPopup);
        // Delay to ensure the first popup is hidden before showing the next
        setTimeout(() => {
            submissionFormContainer.classList.remove('hidden');
            submissionSuccess.classList.add('hidden');
            submissionForm.reset();
            if(fileNameDisplay) fileNameDisplay.textContent = '';
            if(formError) formError.style.display = 'none';
            showPopup(submissionPopup);
        }, 500);
    };
    
    if(ctaFooterBtn) ctaFooterBtn.addEventListener('click', () => showPopup(offerPopup));
    if(ctaPopupBtn) ctaPopupBtn.addEventListener('click', openSubmissionPopup);
    if(closeOfferPopupBtn) closeOfferPopupBtn.addEventListener('click', () => hidePopup(offerPopup));
    if(closeSubmissionPopupBtn) closeSubmissionPopupBtn.addEventListener('click', () => hidePopup(submissionPopup));

    if(submissionForm) {
        submissionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitButton = e.target.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.textContent = 'Enviando...';
            formError.style.display = 'none';
            
            const formData = new FormData();
            formData.append('whatsapp', document.getElementById('whatsapp-input').value);
            formData.append('link', document.getElementById('link-input').value);
            
            if (fileUpload.files.length > 0) {
                formData.append('file-upload', fileUpload.files[0]);
            }
            
            const renderUrl = 'https://meucatalogointeligente.onrender.com/submit';

            try {
                const response = await fetch(renderUrl, {
                    method: 'POST',
                    body: formData,
                });

                if (!response.ok) {
                    throw new Error('Falha no envio. Por favor, tente novamente mais tarde.');
                }

                submissionFormContainer.classList.add('hidden');
                submissionSuccess.classList.remove('hidden');

                setTimeout(() => {
                    hidePopup(submissionPopup);
                    // Reset button state after popup is fully closed
                    setTimeout(() => {
                        submitButton.disabled = false;
                        submitButton.textContent = 'Enviar e Começar Teste Grátis';
                    }, 500);
                }, 5000);

            } catch (error) {
                console.error('Erro no envio do formulário:', error);
                formError.textContent = error.message;
                formError.style.display = 'block';
                submitButton.disabled = false;
                submitButton.textContent = 'Enviar e Começar Teste Grátis';
            }
        });
    }
    
    if(fileUpload) {
        fileUpload.addEventListener('change', () => {
            if (fileNameDisplay) {
                fileNameDisplay.textContent = fileUpload.files.length > 0 ? fileUpload.files[0].name : '';
            }
        });
    }

    // Popup de oferta inicial (após 10 segundos)
    setTimeout(() => {
        // Check if any popup is already open
        const isPopupOpen = !!document.querySelector('#offer-popup:not(.hidden), #submission-popup:not(.hidden)');
        if (!sessionStorage.getItem('offerShown') && !isPopupOpen) {
            showPopup(offerPopup);
            sessionStorage.setItem('offerShown', 'true');
        }
    }, 10000);

    // Popup de intenção de saída
    document.addEventListener('mouseleave', (e) => {
        const isPopupOpen = !!document.querySelector('#offer-popup:not(.hidden), #submission-popup:not(.hidden)');
        if (e.clientY <= 0 && !sessionStorage.getItem('exitIntentShown') && !isPopupOpen) {
            showPopup(offerPopup);
            sessionStorage.setItem('exitIntentShown', 'true');
            sessionStorage.setItem('offerShown', 'true'); // Also mark it as shown
        }
    });
    
    // --- INICIALIZAÇÃO ---
    renderMenu();
    updateCart(); // Para carregar o carrinho salvo
});
</script>

</body>
</html>
